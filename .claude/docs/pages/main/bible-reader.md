# 성경 리더 페이지

> **경로**: `/bible-reader`
> **파일**: `src/app/(main)/bible-reader/page.tsx`
> **복잡도**: ★★★★★ (높음)
> **최종 업데이트**: 2026-01-25

---

## 개요

### 목적
성경 본문을 읽고, 구절을 선택하여 복사하거나 묵상을 작성할 수 있는 핵심 페이지입니다.

### 주요 기능
- 성경 본문 열람 (개역개정/현대인의성경)
- 책/장 선택 및 네비게이션
- 스와이프로 장 이동
- 구절 선택 (클릭/Long Press 드래그)
- 선택 구절 복사
- 묵상 패널로 구절 전달

---

## 의존성

### 사용하는 훅
| 훅 | 파일 | 용도 |
|----|------|------|
| `useCurrentUser` | `useUser.ts` | 사용자 정보 |
| `useCreateComment` | `useComment.ts` | 묵상 생성 |
| `useGroupCompat` | `useGroupStore.ts` | 활성 그룹 |
| `useToast` | `toast.tsx` | 토스트 알림 |

### 사용하는 컴포넌트
| 컴포넌트 | 용도 |
|----------|------|
| `MeditationPanel` | 묵상 작성 패널 (바텀시트/사이드) |
| `BibleAccessGuard` | 접근 권한 체크 |
| `Select` | 책/장/버전 선택 |
| `Card` | 본문 표시 영역 |

---

## 상태 관리

### 로컬 상태
| 상태 | 타입 | 초기값 | 설명 |
|------|------|--------|------|
| `selectedBook` | `string` | URL 파라미터 또는 '창세기' | 선택된 책 |
| `selectedChapter` | `number` | URL 파라미터 또는 1 | 선택된 장 |
| `selectedVersion` | `BibleVersion` | `'revised'` | 번역본 |
| `verses` | `Record<number, string>` | `{}` | 현재 장의 구절들 |
| `selectedVerses` | `Set<number>` | `new Set()` | 선택된 구절 번호들 |
| `isSelecting` | `boolean` | `false` | 범위 선택 모드 |
| `isDraggingSelection` | `boolean` | `false` | 드래그 선택 중 |
| `meditationPanelOpen` | `boolean` | `false` | 묵상 패널 열림 |
| `meditationVerses` | `SelectedVerse[]` | `[]` | 묵상에 추가된 구절 |

### URL 파라미터
| 파라미터 | 설명 |
|----------|------|
| `book` | 성경 책 이름 |
| `chapter` | 장 번호 |
| `day` | Day 번호 (묵상 저장 시 사용) |

---

## UI 구성

### 레이아웃
```
┌────────────────────────┐
│ [←] 성경 읽기 헤더      │
├────────────────────────┤
│ [개역개정 ▼]           │ ← 번역본 선택
├────────────────────────┤
│ [창세기 ▼] [1장 ▼]     │ ← 책/장 선택
├────────────────────────┤
│ [이전 장]    [다음 장]  │
├────────────────────────┤
│ (선택 모드 안내)        │ ← 조건부
├────────────────────────┤
│ ┌──────────────────┐   │
│ │ 창세기 1장        │   │
│ │                  │   │ ← 스와이프 가능
│ │ 1. 태초에 ...    │   │
│ │ 2. 땅이 ...      │   │
│ │ ...              │   │
│ └──────────────────┘   │
├────────────────────────┤
│ [묵상 작성하기]         │
└────────────────────────┘
     + MeditationPanel (바텀시트)
```

### 컴포넌트 트리
```
BibleReaderPage
└── Suspense
    └── BibleAccessGuard
        └── BibleReaderContent
            ├── 헤더 (뒤로가기, 제목)
            ├── Select (버전)
            ├── Select (책), Select (장)
            ├── 네비게이션 버튼
            ├── 선택 모드 안내 (조건부)
            ├── 선택 액션 바 (조건부)
            ├── Card (본문)
            │   └── 구절 목록 (클릭/드래그 가능)
            ├── 안내 텍스트
            ├── 묵상 작성 버튼
            └── MeditationPanel
```

### 상태별 UI
| 상태 | 표시 내용 |
|------|----------|
| 로딩 | 본문 영역에 스피너 |
| 본문 없음 | "해당 장의 본문을 찾을 수 없습니다" |
| 구절 선택 중 | 파란색 선택 모드 안내 바 |
| 구절 선택됨 | 액션 바 (묵상/복사/취소) |
| 정상 | 본문 표시 |

---

## 비즈니스 로직

### 핵심 로직
1. **본문 로드**: `getChapter(book, chapter, version)` 호출
2. **스와이프**: 80px 이상 이동 시 이전/다음 장
3. **구절 클릭**: 토글 선택 + 클립보드 복사
4. **Long Press**: 500ms 후 범위 선택 모드 진입
5. **드래그 선택**: 터치/마우스 이동으로 범위 확장

### 구절 선택 흐름
```
1. 구절 클릭 → 선택 + 복사
2. 구절 Long Press → 범위 선택 모드
3. 드래그 → 범위 확장
4. 손 떼기 → 선택 완료 (복사 또는 묵상에 추가)
```

### 묵상 작성 흐름
```
1. 구절 선택
2. "묵상" 버튼 또는 "묵상 작성하기" 버튼
3. MeditationPanel 열림
4. 내용 작성
5. 발행 → useCreateComment 호출
```

---

## API / 데이터

### 사용하는 테이블
| 테이블 | 용도 | RLS |
|--------|------|-----|
| `comments` | 묵상 저장 | 예 |

### 외부 데이터
| 파일/함수 | 용도 |
|----------|------|
| `bibleLoader.getChapter()` | 성경 본문 로드 |
| `bibleBooks.BIBLE_BOOKS` | 성경 66권 정보 |

---

## 접근 권한

| 사용자 유형 | 접근 가능 | 비고 |
|-------------|----------|------|
| 비로그인 | O | 읽기만 가능 |
| 로그인 (그룹 없음) | O | 묵상 발행 불가 |
| 로그인 (그룹 있음) | O | 전체 기능 |

---

## 관련 문서

- [bible.md](./bible.md) - 성경 전체 보기
- [qt-day.md](./qt-day.md) - QT 페이지
- [home.md](./home.md) - 홈 페이지

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-01-25 | 최초 작성 |
