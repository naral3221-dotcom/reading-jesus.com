# 검색 페이지

> **경로**: `/search`
> **파일**: `src/app/(main)/search/page.tsx`
> **복잡도**: ★★★☆☆ (중간)
> **최종 업데이트**: 2026-01-25

---

## 개요

### 목적
성경 본문과 묵상 나눔을 검색할 수 있는 통합 검색 페이지입니다.

### 주요 기능
- 성경 본문 검색 (개역개정)
- 묵상 나눔 검색 (사용자가 속한 그룹만)
- 페이지네이션 (더 보기)
- 검색 결과 클릭 시 해당 페이지로 이동

---

## 의존성

### 사용하는 훅
| 훅 | 파일 | 용도 |
|----|------|------|
| `useCurrentUser` | `useUser.ts` | 사용자 정보 |
| `useUserGroups` | `useGroup.ts` | 사용자 소속 그룹 |

### 직접 호출
| 함수 | 파일 | 용도 |
|------|------|------|
| `searchBible()` | `bibleLoader.ts` | 성경 본문 검색 |
| `getSupabaseBrowserClient()` | `client.ts` | 묵상 검색 (직접 쿼리) |

### 사용하는 컴포넌트
| 컴포넌트 | 용도 |
|----------|------|
| `Input` | 검색어 입력 |
| `Tabs` | 성경/묵상 탭 |
| `Card` | 검색 결과 카드 |
| `NoSearchResultsEmpty` | 결과 없음 상태 |
| `InlineError` | 에러 표시 |

---

## 상태 관리

### 로컬 상태
| 상태 | 타입 | 초기값 | 설명 |
|------|------|--------|------|
| `query` | `string` | `''` | 검색어 |
| `searchType` | `'bible' \| 'comments'` | `'bible'` | 검색 유형 |
| `searching` | `boolean` | `false` | 검색 중 |
| `allBibleResults` | `BibleSearchResult[]` | `[]` | 전체 성경 검색 결과 |
| `bibleDisplayCount` | `number` | `20` | 표시할 성경 결과 수 |
| `allCommentResults` | `CommentWithProfile[]` | `[]` | 전체 묵상 검색 결과 |
| `commentDisplayCount` | `number` | `20` | 표시할 묵상 결과 수 |
| `searchError` | `string \| null` | `null` | 에러 메시지 |

---

## UI 구성

### 레이아웃
```
┌────────────────────────┐
│ [←] 🔍 검색             │
├────────────────────────┤
│ [검색어 입력____] [🔍] │
├────────────────────────┤
│ [성경 본문] [묵상 나눔] │ ← 탭
├────────────────────────┤
│ X개 중 Y개 표시        │
├────────────────────────┤
│ 📖 창세기 1:1          │
│ 태초에 하나님이...      │
├────────────────────────┤
│ 📖 요한복음 1:1        │
│ 태초에 말씀이...        │
├────────────────────────┤
│    [더 보기 (Z개 더)]   │
└────────────────────────┘
```

### 상태별 UI
| 상태 | 표시 내용 |
|------|----------|
| 검색 전 | 안내 메시지 + 아이콘 |
| 검색 중 | 스피너 |
| 결과 없음 | `<NoSearchResultsEmpty />` |
| 에러 | `<InlineError />` |
| 정상 | 검색 결과 카드 목록 |

---

## 비즈니스 로직

### 검색 흐름
```
1. 검색어 입력 + Enter 또는 버튼 클릭
2. searchType에 따라 분기
3. 성경: searchBible() 호출 (최대 200개)
4. 묵상: Supabase 직접 쿼리 (소속 그룹만)
5. 결과 저장 + 20개씩 표시
6. "더 보기" 클릭 시 displayCount 증가
```

### 묵상 검색 제한
- 로그인 필수
- 사용자가 속한 그룹의 묵상만 검색
- 그룹이 없으면 빈 결과

### 페이지네이션
- 초기 표시: 20개 (`PAGE_SIZE`)
- 전체 결과: 최대 200개 저장
- "더 보기" 클릭 시 20개씩 추가

---

## API / 데이터

### 사용하는 테이블
| 테이블 | 용도 | RLS |
|--------|------|-----|
| `comments` | 묵상 검색 | 예 |
| `profiles` | 작성자 정보 | 예 |

### 외부 데이터
| 함수 | 용도 |
|------|------|
| `searchBible(query, version, limit)` | 성경 본문 검색 |

---

## 접근 권한

| 사용자 유형 | 접근 가능 | 비고 |
|-------------|----------|------|
| 비로그인 | △ | 성경 검색만 가능 |
| 로그인 | O | 전체 기능 |

---

## 관련 문서

- [bible-reader.md](./bible-reader.md) - 성경 리더
- [home.md](./home.md) - 홈 (묵상 피드)

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-01-25 | 최초 작성 |
