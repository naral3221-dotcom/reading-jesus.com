# 성경 전체 보기 페이지

> **경로**: `/bible`
> **파일**: `src/app/(main)/bible/page.tsx`
> **복잡도**: ★★★★☆ (중상)
> **최종 업데이트**: 2026-01-25

---

## 개요

### 목적
성경 66권을 구약/신약으로 분류하고, 365일 통독 일정을 표시합니다.
각 책/Day를 클릭하여 성경 리더로 이동할 수 있습니다.

### 주요 기능
- 통독 일정 탭 (Day별 읽기 상태, Long Press로 체크)
- 구약 탭 (39권 카드)
- 신약 탭 (27권 카드)
- 플랜 선택기
- 책별 진도 표시

---

## 의존성

### 사용하는 훅
| 훅 | 파일 | 용도 |
|----|------|------|
| `useGroupCompat` | `useGroupStore.ts` | 활성 그룹 정보 |
| `useCurrentUser` | `useUser.ts` | 현재 사용자 |
| `useReadingCheckWithToggle` | `useReadingCheck.ts` | 읽음 체크 |
| `useToast` | `toast.tsx` | 토스트 알림 |

### 사용하는 컴포넌트
| 컴포넌트 | 용도 |
|----------|------|
| `Card` | 책/Day 카드 |
| `Tabs` | 통독일정/구약/신약 탭 |
| `PlanSelector` | 플랜 선택 드롭다운 |
| `HelpButton` | 도움말 버튼 |
| `AlertDialog` | 체크 확인 다이얼로그 |

---

## 상태 관리

### 로컬 상태
| 상태 | 타입 | 초기값 | 설명 |
|------|------|--------|------|
| `selectedPlanId` | `string \| null` | `READING_JESUS_2026_PLAN_ID` | 선택된 플랜 |
| `showCheckDialog` | `boolean` | `false` | 체크 다이얼로그 |
| `selectedDay` | `number \| null` | `null` | 선택된 Day |
| `showAllSchedule` | `boolean` | `false` | 전체 일정 표시 |

### 서버 상태 (React Query)
| 쿼리 | 데이터 | 갱신 시점 |
|------|--------|----------|
| `useReadingCheckWithToggle` | checkedDays Map | 체크 토글 시 |
| `useCurrentUser` | 사용자 정보 | 마운트 시 |

---

## UI 구성

### 레이아웃
```
┌────────────────────────┐
│  성경 전체 보기 헤더     │ ← 제목 + 진도 + 도움말
├────────────────────────┤
│  플랜 선택기            │ ← PlanSelector
├────────────────────────┤
│ [통독일정] [구약] [신약] │ ← 탭 네비게이션
├────────────────────────┤
│                        │
│      탭 컨텐츠          │
│                        │
└────────────────────────┘
```

### 탭별 컨텐츠

**통독 일정 탭**
```
┌─────────────────────────┐
│ 오늘은 Day X입니다       │
│ 💡 길게 누르면 체크 가능  │
├─────────────────────────┤
│ [42] 창세기 1-4장        │ ← Day 카드 (Long Press)
│ [✓] 창세기 5-8장        │ ← 체크된 Day
│ [44] 창세기 9-12장       │
│        ...              │
├─────────────────────────┤
│   [전체 일정 보기]       │
└─────────────────────────┘
```

**구약/신약 탭**
```
┌──────┬──────┬──────┐
│창세기 │출애굽│레위기 │
│ 2/5일 │ 0/3일│ 1/4일│
├──────┼──────┼──────┤
│민수기 │신명기│여호수아│
│ ...  │ ... │ ...  │
└──────┴──────┴──────┘
```

### 상태별 UI
| 상태 | 표시 내용 |
|------|----------|
| 로딩 | 중앙 스피너 |
| 그룹 있음 | 전체 기능 |
| 그룹 없음 | 진도 표시 안됨 (opacity-50) |

---

## 비즈니스 로직

### 핵심 로직
1. **오늘 Day 계산**: 그룹 시작일 기준 differenceInDays + 1
2. **필터링**: 기본 ±3일, 전체 보기 토글
3. **Long Press**: 500ms 후 체크 다이얼로그 표시
4. **책별 진도**: bookDays에서 체크된 Day 수 계산

### Long Press 핸들링
```typescript
handleLongPressStart(day) → setTimeout 500ms → showCheckDialog
handleLongPressEnd() → clearTimeout
```

### 사용자 흐름
```
1. 페이지 진입
2. 탭 선택 (통독일정/구약/신약)
3. 통독일정: Day Long Press → 체크 다이얼로그 → 확인
4. 구약/신약: 책 클릭 → /bible-reader로 이동
```

---

## API / 데이터

### 사용하는 테이블
| 테이블 | 용도 | RLS |
|--------|------|-----|
| `reading_checks` | 읽음 체크 | 예 |
| `groups` | 그룹 시작일 | 예 |

### 외부 데이터
| 파일 | 용도 |
|------|------|
| `reading_plan.json` | 365일 통독 일정 |
| `helpContent.ts` | 도움말 내용 |

### 상수
```typescript
oldTestament = ['창세기', '출애굽기', ...] // 39권
newTestament = ['마태복음', '마가복음', ...] // 27권
```

---

## 접근 권한

| 사용자 유형 | 접근 가능 | 비고 |
|-------------|----------|------|
| 비로그인 | O | 진도 표시 안됨 |
| 로그인 (그룹 없음) | O | 진도 표시 안됨 |
| 로그인 (그룹 있음) | O | 전체 기능 |

---

## 관련 문서

- [bible-reader.md](./bible-reader.md) - 성경 리더 페이지
- [qt-day.md](./qt-day.md) - QT 페이지
- [home.md](./home.md) - 홈 페이지

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-01-25 | 최초 작성 |
