# ë¦¬ë”©ì§€ì €ìŠ¤ ë°±ì—”ë“œ ì•„í‚¤í…ì²˜

> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-01
> **ë²„ì „**: 2.0.0 (ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ ì™„ë£Œ)

---

## ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [í…Œì´ë¸” êµ¬ì¡°](#í…Œì´ë¸”-êµ¬ì¡°)
3. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
4. [ë™ê¸°í™” ì‹œìŠ¤í…œ](#ë™ê¸°í™”-ì‹œìŠ¤í…œ)
5. [RLS ì •ì±…](#rls-ì •ì±…)
6. [ìœ ì§€ë³´ìˆ˜ ë„êµ¬](#ìœ ì§€ë³´ìˆ˜-ë„êµ¬)

---

## ê°œìš”

### í•µì‹¬ ê°œë…

ë¦¬ë”©ì§€ì €ìŠ¤ëŠ” **ë ˆê±°ì‹œ í…Œì´ë¸”**ê³¼ **í†µí•©(Unified) í…Œì´ë¸”** ë‘ ê°€ì§€ ë ˆì´ì–´ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í†µí•© í…Œì´ë¸” (Unified)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ unified_meditations â”‚  â”‚ unified_reading_checks          â”‚   â”‚
â”‚  â”‚ (ëª¨ë“  ë¬µìƒê¸€ í†µí•©)    â”‚  â”‚ (ëª¨ë“  ì½ìŒ ì²´í¬ í†µí•©)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                    ìë™ ë™ê¸°í™” (íŠ¸ë¦¬ê±°)
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ë ˆê±°ì‹œ í…Œì´ë¸” (Legacy)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚church_qt_postsâ”‚ â”‚guest_commentsâ”‚  â”‚ comments              â”‚ â”‚
â”‚  â”‚ (êµíšŒ QTê¸€)    â”‚ â”‚ (ê²ŒìŠ¤íŠ¸ë¬µìƒê¸€) â”‚  â”‚ (ê·¸ë£¹ ë¬µìƒê¸€)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìš©ì–´ ì •ì˜

| í…Œì´ë¸”ëª… | ì‹¤ì œ ì˜ë¯¸ | ì„¤ëª… |
|----------|----------|------|
| `church_qt_posts` | **êµíšŒ QT ë‚˜ëˆ”ê¸€** | ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ ì‘ì„±í•œ êµ¬ì¡°í™”ëœ QT (ì§ˆë¬¸/ë‹µë³€ í˜•ì‹) |
| `guest_comments` | **ê²ŒìŠ¤íŠ¸ ë¬µìƒê¸€** âš ï¸ | ë¹„ë¡œê·¸ì¸(ê²ŒìŠ¤íŠ¸) ì‚¬ìš©ìê°€ ì‘ì„±í•œ ììœ  ë¬µìƒê¸€ |
| `comments` | **ê·¸ë£¹ ë¬µìƒê¸€** | ê·¸ë£¹ ë‚´ì—ì„œ ì‘ì„±í•œ ììœ  ë¬µìƒê¸€ |
| `public_meditations` | **ê³µê°œ ë¬µìƒê¸€** | í™ˆ í”¼ë“œì— ê³µê°œëœ ë¬µìƒê¸€ |

> âš ï¸ **ì£¼ì˜**: `guest_comments`ëŠ” "ëŒ“ê¸€"ì´ ì•„ë‹™ë‹ˆë‹¤! **ê²ŒìŠ¤íŠ¸ê°€ ì‘ì„±í•œ ë¬µìƒê¸€**ì…ë‹ˆë‹¤.

---

## í…Œì´ë¸” êµ¬ì¡°

### 1. ì‚¬ìš©ì ë° ì¡°ì§

#### profiles (ì‚¬ìš©ì í”„ë¡œí•„)
```sql
profiles
â”œâ”€â”€ id: UUID (PK, auth.users ì°¸ì¡°)
â”œâ”€â”€ nickname: TEXT
â”œâ”€â”€ avatar_url: TEXT
â”œâ”€â”€ church_id: UUID (FK â†’ churches)
â”œâ”€â”€ church_code: TEXT
â”œâ”€â”€ active_group_id: UUID
â”œâ”€â”€ onboarding_completed: BOOLEAN
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ
```

#### churches (êµíšŒ)
```sql
churches
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ name: TEXT
â”œâ”€â”€ code: TEXT (UNIQUE, ê°€ì… ì½”ë“œ)
â”œâ”€â”€ description: TEXT
â”œâ”€â”€ logo_url: TEXT
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ
```

#### church_members (êµíšŒ ë©¤ë²„)
```sql
church_members
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ church_id: UUID (FK â†’ churches)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ role: TEXT ('member' | 'admin')
â”œâ”€â”€ joined_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(church_id, user_id)
```

#### church_admins (êµíšŒ ê´€ë¦¬ì)
```sql
church_admins
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ church_id: UUID (FK â†’ churches)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(church_id, user_id)
```

#### groups (ê·¸ë£¹)
```sql
groups
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ church_id: UUID (FK â†’ churches, nullable)
â”œâ”€â”€ name: TEXT
â”œâ”€â”€ description: TEXT
â”œâ”€â”€ is_public: BOOLEAN
â”œâ”€â”€ invite_code: TEXT (UNIQUE)
â”œâ”€â”€ reading_plan_id: UUID
â”œâ”€â”€ created_by: UUID (FK â†’ profiles)
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ
```

#### group_members (ê·¸ë£¹ ë©¤ë²„)
```sql
group_members
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ group_id: UUID (FK â†’ groups)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ role: TEXT ('member' | 'admin')
â”œâ”€â”€ joined_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(group_id, user_id)
```

---

### 2. ë¬µìƒê¸€ (ë ˆê±°ì‹œ)

#### church_qt_posts (êµíšŒ QT ë‚˜ëˆ”ê¸€) ğŸ”µ
```sql
church_qt_posts
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ church_id: UUID (FK â†’ churches)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles, nullable)
â”œâ”€â”€ author_name: TEXT
â”œâ”€â”€ day_number: INTEGER (1~365)
â”œâ”€â”€ qt_date: DATE
â”œâ”€â”€ my_sentence: TEXT (ë‚´ ë§ë¡œ í•œ ë¬¸ì¥)
â”œâ”€â”€ meditation_answer: TEXT (ë¬µìƒ ë‹µë³€)
â”œâ”€â”€ gratitude: TEXT (ê°ì‚¬)
â”œâ”€â”€ my_prayer: TEXT (ê¸°ë„)
â”œâ”€â”€ day_review: TEXT (í•˜ë£¨ ì ê²€)
â”œâ”€â”€ is_anonymous: BOOLEAN
â”œâ”€â”€ visibility: content_visibility ('private'|'church'|'public')
â”œâ”€â”€ is_pinned: BOOLEAN
â”œâ”€â”€ likes_count: INTEGER
â”œâ”€â”€ replies_count: INTEGER
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ

ğŸ”„ íŠ¸ë¦¬ê±°: sync_qt_to_unified â†’ unified_meditations ìë™ ë™ê¸°í™”
```

#### guest_comments (ê²ŒìŠ¤íŠ¸ ë¬µìƒê¸€) ğŸŸ¢
```sql
guest_comments
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ church_id: UUID (FK â†’ churches)
â”œâ”€â”€ linked_user_id: UUID (ë‚˜ì¤‘ì— ì—°ê²°ëœ user_id)
â”œâ”€â”€ device_id: TEXT (ê²ŒìŠ¤íŠ¸ ì‹ë³„ì)
â”œâ”€â”€ guest_name: TEXT (ì‘ì„±ì í‘œì‹œëª…)
â”œâ”€â”€ day_number: INTEGER
â”œâ”€â”€ qt_date: DATE
â”œâ”€â”€ content: TEXT (ììœ  ë¬µìƒ ë‚´ìš©)
â”œâ”€â”€ my_sentence: TEXT
â”œâ”€â”€ meditation_answer: TEXT
â”œâ”€â”€ bible_range: TEXT
â”œâ”€â”€ is_anonymous: BOOLEAN
â”œâ”€â”€ visibility: content_visibility
â”œâ”€â”€ likes_count: INTEGER
â”œâ”€â”€ replies_count: INTEGER
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ

ğŸ”„ íŠ¸ë¦¬ê±°: sync_guest_comment_to_unified â†’ unified_meditations ìë™ ë™ê¸°í™”

âš ï¸ ì´ë¦„ì€ "comments"ì§€ë§Œ ì‹¤ì œë¡œëŠ” ë¬µìƒê¸€ì…ë‹ˆë‹¤!
```

#### comments (ê·¸ë£¹ ë¬µìƒê¸€) ğŸŸ¡
```sql
comments
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ group_id: UUID (FK â†’ groups)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ day_number: INTEGER
â”œâ”€â”€ content: TEXT
â”œâ”€â”€ is_anonymous: BOOLEAN
â”œâ”€â”€ visibility: content_visibility
â”œâ”€â”€ is_pinned: BOOLEAN
â”œâ”€â”€ likes_count: INTEGER
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ
```

#### public_meditations (ê³µê°œ ë¬µìƒê¸€) ğŸŸ£
```sql
public_meditations
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ bible_reference: TEXT
â”œâ”€â”€ content: TEXT
â”œâ”€â”€ visibility: content_visibility
â”œâ”€â”€ likes_count: INTEGER
â”œâ”€â”€ replies_count: INTEGER
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ
```

---

### 3. í†µí•© í…Œì´ë¸” (Unified)

#### unified_meditations (í†µí•© ë¬µìƒê¸€)
```sql
unified_meditations
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles, nullable)
â”œâ”€â”€ guest_token: TEXT (ê²ŒìŠ¤íŠ¸ ì‹ë³„ìš©)
â”œâ”€â”€ author_name: TEXT
â”‚
â”œâ”€â”€ source_type: TEXT ('group' | 'church')
â”œâ”€â”€ source_id: UUID (group_id ë˜ëŠ” church_id)
â”œâ”€â”€ content_type: TEXT ('free' | 'qt')
â”‚
â”œâ”€â”€ day_number: INTEGER
â”œâ”€â”€ qt_date: DATE
â”œâ”€â”€ content: TEXT (ììœ  ë¬µìƒ)
â”œâ”€â”€ bible_range: TEXT
â”‚
â”œâ”€â”€ my_sentence: TEXT (QTìš©)
â”œâ”€â”€ meditation_answer: TEXT
â”œâ”€â”€ gratitude: TEXT
â”œâ”€â”€ my_prayer: TEXT
â”œâ”€â”€ day_review: TEXT
â”‚
â”œâ”€â”€ visibility: content_visibility
â”œâ”€â”€ is_anonymous: BOOLEAN
â”œâ”€â”€ is_pinned: BOOLEAN
â”œâ”€â”€ likes_count: INTEGER
â”œâ”€â”€ replies_count: INTEGER
â”‚
â”œâ”€â”€ legacy_table: TEXT ('church_qt_posts'|'guest_comments'|'comments')
â”œâ”€â”€ legacy_id: UUID (ì›ë³¸ í…Œì´ë¸”ì˜ ID)
â”‚
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ updated_at: TIMESTAMPTZ
```

**source_type ê°’ ì„¤ëª…**:
- `'church'`: êµíšŒ ì†Œì† ë¬µìƒê¸€ (church_qt_posts, guest_comments)
- `'group'`: ê·¸ë£¹ ì†Œì† ë¬µìƒê¸€ (comments)

**content_type ê°’ ì„¤ëª…**:
- `'qt'`: êµ¬ì¡°í™”ëœ QT (ì§ˆë¬¸/ë‹µë³€ í˜•ì‹)
- `'free'`: ììœ  ë¬µìƒê¸€

#### unified_reading_checks (í†µí•© ì½ìŒ ì²´í¬)
```sql
unified_reading_checks
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ source_type: TEXT ('group' | 'church')
â”œâ”€â”€ source_id: UUID
â”œâ”€â”€ day_number: INTEGER
â”œâ”€â”€ checked_at: TIMESTAMPTZ
â”œâ”€â”€ created_at: TIMESTAMPTZ
â”œâ”€â”€ legacy_table: TEXT ('daily_checks'|'church_reading_checks')
â”œâ”€â”€ legacy_id: UUID
â””â”€â”€ UNIQUE(user_id, source_type, source_id, day_number)
```

---

### 4. ì¢‹ì•„ìš” & ë‹µê¸€

#### ë ˆê±°ì‹œ ì¢‹ì•„ìš”
```sql
church_qt_post_likes
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ post_id: UUID (FK â†’ church_qt_posts)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â””â”€â”€ created_at: TIMESTAMPTZ

guest_comment_likes
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ comment_id: UUID (FK â†’ guest_comments)
â”œâ”€â”€ user_id: UUID
â”œâ”€â”€ guest_id: TEXT (ê²ŒìŠ¤íŠ¸ ì¢‹ì•„ìš”)
â””â”€â”€ created_at: TIMESTAMPTZ

comment_likes
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ comment_id: UUID (FK â†’ comments)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â””â”€â”€ created_at: TIMESTAMPTZ
```

#### ë ˆê±°ì‹œ ë‹µê¸€
```sql
church_qt_post_replies
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ post_id: UUID (FK â†’ church_qt_posts)
â”œâ”€â”€ user_id: UUID
â”œâ”€â”€ device_id: TEXT
â”œâ”€â”€ guest_name: TEXT
â”œâ”€â”€ content: TEXT
â”œâ”€â”€ is_anonymous: BOOLEAN
â””â”€â”€ created_at: TIMESTAMPTZ

guest_comment_replies
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ comment_id: UUID (FK â†’ guest_comments)
â”œâ”€â”€ user_id: UUID
â”œâ”€â”€ device_id: TEXT
â”œâ”€â”€ guest_name: TEXT
â”œâ”€â”€ content: TEXT
â”œâ”€â”€ is_anonymous: BOOLEAN
â””â”€â”€ created_at: TIMESTAMPTZ

comment_replies
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ comment_id: UUID (FK â†’ comments)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ content: TEXT
â”œâ”€â”€ is_anonymous: BOOLEAN
â””â”€â”€ created_at: TIMESTAMPTZ
```

#### í†µí•© ì¢‹ì•„ìš” & ë‹µê¸€
```sql
unified_meditation_likes
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ meditation_id: UUID (FK â†’ unified_meditations)
â”œâ”€â”€ user_id: UUID
â”œâ”€â”€ guest_token: TEXT
â””â”€â”€ created_at: TIMESTAMPTZ

unified_meditation_replies
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ meditation_id: UUID (FK â†’ unified_meditations)
â”œâ”€â”€ user_id: UUID
â”œâ”€â”€ guest_token: TEXT
â”œâ”€â”€ author_name: TEXT
â”œâ”€â”€ content: TEXT
â”œâ”€â”€ is_anonymous: BOOLEAN
â”œâ”€â”€ legacy_table: TEXT
â”œâ”€â”€ legacy_id: UUID
â””â”€â”€ created_at: TIMESTAMPTZ
```

---

### 5. ì½ìŒ ì²´í¬ (ë ˆê±°ì‹œ)

```sql
daily_checks (ê·¸ë£¹ ì½ìŒ ì²´í¬)
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ group_id: UUID (FK â†’ groups)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ day_number: INTEGER
â”œâ”€â”€ is_read: BOOLEAN
â”œâ”€â”€ checked_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(group_id, user_id, day_number)

church_reading_checks (êµíšŒ ì½ìŒ ì²´í¬)
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ church_id: UUID (FK â†’ churches)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ day_number: INTEGER
â”œâ”€â”€ checked_at: TIMESTAMPTZ
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(church_id, user_id, day_number)
```

---

### 6. ì†Œì…œ ê¸°ëŠ¥

```sql
user_follows (íŒ”ë¡œìš°)
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ follower_id: UUID (FK â†’ profiles)
â”œâ”€â”€ following_id: UUID (FK â†’ profiles)
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(follower_id, following_id)

user_bookmarks (ë¶ë§ˆí¬)
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ meditation_id: UUID
â”œâ”€â”€ meditation_source: TEXT ('unified' | 'public')
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ UNIQUE(user_id, meditation_id, meditation_source)

notifications (ì•Œë¦¼)
â”œâ”€â”€ id: UUID (PK)
â”œâ”€â”€ user_id: UUID (FK â†’ profiles)
â”œâ”€â”€ type: TEXT
â”œâ”€â”€ title: TEXT
â”œâ”€â”€ message: TEXT
â”œâ”€â”€ data: JSONB
â”œâ”€â”€ is_read: BOOLEAN
â”œâ”€â”€ created_at: TIMESTAMPTZ
â””â”€â”€ read_at: TIMESTAMPTZ
```

---

## ë°ì´í„° íë¦„

### ë¬µìƒê¸€ ì‘ì„± íë¦„

```
ì‚¬ìš©ìê°€ ë¬µìƒê¸€ ì‘ì„±
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì–´ë””ì„œ ì‘ì„±?                                        â”‚
â”‚                                                    â”‚
â”‚  êµíšŒ QT í˜ì´ì§€      êµíšŒ í”¼ë“œ(ê²ŒìŠ¤íŠ¸)    ê·¸ë£¹ í˜ì´ì§€  â”‚
â”‚       â”‚                   â”‚                â”‚       â”‚
â”‚       â–¼                   â–¼                â–¼       â”‚
â”‚  church_qt_posts    guest_comments     comments    â”‚
â”‚       â”‚                   â”‚                â”‚       â”‚
â”‚       â–¼                   â–¼                â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        unified_meditations                  â”‚   â”‚
â”‚  â”‚   (íŠ¸ë¦¬ê±°ë¡œ ìë™ ë™ê¸°í™”)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í”¼ë“œ ì¡°íšŒ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í”¼ë“œ ì¡°íšŒ                      â”‚
â”‚                                                 â”‚
â”‚  êµíšŒ í”¼ë“œ          í™ˆ í”¼ë“œ          í”„ë¡œí•„ í”¼ë“œ   â”‚
â”‚     â”‚                 â”‚                 â”‚       â”‚
â”‚     â–¼                 â–¼                 â–¼       â”‚
â”‚  ë ˆê±°ì‹œ í…Œì´ë¸”      ë ˆê±°ì‹œ í…Œì´ë¸”     unified     â”‚
â”‚  (church_qt_posts  (church_qt_posts  _meditationsâ”‚
â”‚   guest_comments)   guest_comments               â”‚
â”‚                     comments)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **ì°¸ê³ **: êµíšŒ í”¼ë“œì™€ í™ˆ í”¼ë“œëŠ” ë ˆê±°ì‹œ í…Œì´ë¸”ì„ ì§ì ‘ ì¡°íšŒí•©ë‹ˆë‹¤.
> í”„ë¡œí•„ì˜ "ë‚´ê°€ ì“´ ê¸€"ì€ unified_meditationsë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

---

## ë™ê¸°í™” ì‹œìŠ¤í…œ

### í™œì„± íŠ¸ë¦¬ê±°

| íŠ¸ë¦¬ê±° | ì›ë³¸ í…Œì´ë¸” | ëŒ€ìƒ í…Œì´ë¸” | ë™ì‘ |
|--------|------------|------------|------|
| `sync_qt_to_unified` | church_qt_posts | unified_meditations | INSERT/UPDATE/DELETE |
| `sync_guest_comment_to_unified` | guest_comments | unified_meditations | INSERT/UPDATE/DELETE |
| `sync_comment_to_unified` | comments | unified_meditations | INSERT/UPDATE/DELETE |

### ë¯¸ë™ê¸°í™” í…Œì´ë¸”

| ì›ë³¸ í…Œì´ë¸” | ë™ê¸°í™” ìƒíƒœ | ë¹„ê³  |
|------------|-----------|------|
| public_meditations | âŒ ë³„ë„ | í†µí•© í…Œì´ë¸”ê³¼ ë³„ê°œ |

### ë™ê¸°í™” í•„ë“œ ë§¤í•‘

#### church_qt_posts â†’ unified_meditations
```
user_id         â†’ user_id
church_id       â†’ source_id
'church'        â†’ source_type
'qt'            â†’ content_type
author_name     â†’ author_name
day_number      â†’ day_number
qt_date         â†’ qt_date
my_sentence     â†’ my_sentence
meditation_answer â†’ meditation_answer
gratitude       â†’ gratitude
my_prayer       â†’ my_prayer
day_review      â†’ day_review
visibility      â†’ visibility
is_anonymous    â†’ is_anonymous
is_pinned       â†’ is_pinned
likes_count     â†’ likes_count
replies_count   â†’ replies_count
id              â†’ legacy_id
'church_qt_posts' â†’ legacy_table
```

#### guest_comments â†’ unified_meditations
```
linked_user_id  â†’ user_id
device_id       â†’ guest_token
church_id       â†’ source_id
'church'        â†’ source_type
'free'          â†’ content_type
guest_name      â†’ author_name
day_number      â†’ day_number
content         â†’ content
bible_range     â†’ bible_range
visibility      â†’ visibility
is_anonymous    â†’ is_anonymous
likes_count     â†’ likes_count
replies_count   â†’ replies_count
id              â†’ legacy_id
'guest_comments' â†’ legacy_table
```

---

## RLS ì •ì±…

### visibility ê¸°ë°˜ ì ‘ê·¼ ì œì–´

```sql
-- content_visibility ENUM
'private'  -- ë³¸ì¸ë§Œ
'group'    -- ê·¸ë£¹ ë©¤ë²„ë§Œ
'church'   -- êµíšŒ ë©¤ë²„ë§Œ
'public'   -- ì „ì²´ ê³µê°œ
```

### ì£¼ìš” RLS ì •ì±…

#### unified_meditations
- **SELECT**: visibilityì— ë”°ë¼ ì ‘ê·¼ ì œì–´
  - `public`: ëª¨ë“  ì‚¬ìš©ì
  - `church`: ê°™ì€ êµíšŒ ë©¤ë²„
  - `group`: ê°™ì€ ê·¸ë£¹ ë©¤ë²„
  - `private`: ì‘ì„±ìë§Œ
- **INSERT**: ì¸ì¦ëœ ì‚¬ìš©ì ë˜ëŠ” guest_token ìˆëŠ” ê²ŒìŠ¤íŠ¸
- **UPDATE**: ë³¸ì¸ë§Œ
- **DELETE**: ë³¸ì¸ ë˜ëŠ” ê´€ë¦¬ì

#### church_qt_posts / guest_comments
- êµíšŒ ë©¤ë²„ë§Œ ì¡°íšŒ ê°€ëŠ¥ (visibility ì¡°ê±´ ì¶”ê°€)
- ë³¸ì¸ ê¸€ë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥

---

## ìœ ì§€ë³´ìˆ˜ ë„êµ¬

### ì ê²€ ìŠ¤í¬ë¦½íŠ¸

```bash
# ë°±ì—”ë“œ ì „ì²´ ì •í•©ì„± ì ê²€
npx tsx scripts/backend-health-check.ts

# ì ê²€ í•­ëª©:
# - í…Œì´ë¸”ë³„ ë ˆì½”ë“œ ìˆ˜
# - ë ˆê±°ì‹œ â†’ unified ë™ê¸°í™” ìƒíƒœ
# - ì½ìŒ ì²´í¬ ë™ê¸°í™” ìƒíƒœ
# - ì¢‹ì•„ìš”/ë‹µê¸€ ë™ê¸°í™” ìƒíƒœ
# - ê³ ì•„ ë°ì´í„° í™•ì¸
# - visibility ì¼ê´€ì„±
# - likes_count/replies_count ì •í•©ì„±
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

```bash
# ë¬µìƒê¸€ ëˆ„ë½ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
npx tsx scripts/migrate-missing-data.ts

# ê²ŒìŠ¤íŠ¸ ë¬µìƒê¸€ë§Œ ë§ˆì´ê·¸ë ˆì´ì…˜
npx tsx scripts/migrate-guest-comments.ts

# ì½ìŒ ì²´í¬ ëˆ„ë½ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
npx tsx scripts/migrate-reading-checks.ts

# ë°ì´í„° ë¶„ì„
npx tsx scripts/final-analysis.ts
```

---

## í˜„ì¬ ë°ì´í„° í˜„í™© (2026-01-31)

| í…Œì´ë¸” | ë ˆì½”ë“œ ìˆ˜ | ì„¤ëª… |
|--------|----------|------|
| profiles | 68 | ë“±ë¡ ì‚¬ìš©ì |
| churches | 1 | êµíšŒ |
| groups | 6 | ê·¸ë£¹ |
| church_qt_posts | 330 | êµíšŒ QT ë‚˜ëˆ”ê¸€ |
| guest_comments | 114 | ê²ŒìŠ¤íŠ¸ ë¬µìƒê¸€ |
| comments | 5 | ê·¸ë£¹ ë¬µìƒê¸€ |
| unified_meditations | 449 | í†µí•© ë¬µìƒê¸€ |
| church_qt_post_likes | 626 | QT ì¢‹ì•„ìš” |
| guest_comment_likes | 368 | ê²ŒìŠ¤íŠ¸ë¬µìƒ ì¢‹ì•„ìš” |
| unified_reading_checks | 184 | í†µí•© ì½ìŒ ì²´í¬ |
| user_follows | 15 | íŒ”ë¡œìš° ê´€ê³„ |

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| 2026-01-31 | ì´ˆì•ˆ ì‘ì„± |
| 2026-01-31 | guest_comments ë™ê¸°í™” íŠ¸ë¦¬ê±° ì¶”ê°€ |
| 2026-01-31 | ëˆ„ë½ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (97ê°œ ë¬µìƒ + 51ê°œ ì½ìŒì²´í¬) |
| 2026-01-31 | comments (ê·¸ë£¹ ë¬µìƒê¸€) ë™ê¸°í™” íŠ¸ë¦¬ê±° ì¶”ê°€ - 3ê°œ í…Œì´ë¸” ì™„ì „ ìë™ ë™ê¸°í™” ì™„ë£Œ |
| 2026-02-01 | **ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ Phase 1-2**: unified_meditations ìŠ¤í‚¤ë§ˆ í™•ì¥ (source_type='public' ì¶”ê°€, source_id NULL í—ˆìš©), public_meditations ë™ê¸°í™” íŠ¸ë¦¬ê±° ì¶”ê°€ |
| 2026-02-01 | **ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ Phase 3**: ì½”ë“œ ëª…ëª… ë³€ê²½ (Comment â†’ Meditation) - 63ê°œ íŒŒì¼ ìˆ˜ì • |
| 2026-02-01 | **ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ Phase 4**: GetUnifiedFeed í†µí•© ì „í™˜ (4ê°œ í…Œì´ë¸” â†’ 1ê°œ í…Œì´ë¸” ì¿¼ë¦¬) |
| 2026-02-01 | **ê²€ì¦ ì™„ë£Œ**: 1ì°¨(ë°ì´í„° ë¬´ê²°ì„± 100%), 2ì°¨(ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ 8/8 í†µê³¼), 3ì°¨(ì„±ëŠ¥ í‰ê·  39.5ms) |
| 2026-02-01 | **ë²„ê·¸ ìˆ˜ì •**: SupabaseUnifiedMeditationRepositoryì˜ update/deleteê°€ ë ˆê±°ì‹œ í…Œì´ë¸” ê²½ìœ í•˜ë„ë¡ ìˆ˜ì • (Dual-Write íŒ¨í„´ ì¤€ìˆ˜) |
| 2026-02-01 | **ì „ì²´ READ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ**: ëª¨ë“  í˜ì´ì§€ì˜ ì½ê¸° ì‘ì—…ì„ unified_meditationsë¡œ í†µí•© (15ê°œ íŒŒì¼) |
| 2026-02-01 | **ìµœì¢… ê²€ì¦**: 49ê°œ ë°±ì—”ë“œ ê²€ì‚¬ ëª¨ë‘ í†µê³¼ |

---

## ì£¼ì˜ì‚¬í•­

1. **guest_commentsëŠ” ëŒ“ê¸€ì´ ì•„ë‹™ë‹ˆë‹¤**
   - ì´ë¦„ì€ "comments"ì´ì§€ë§Œ ì‹¤ì œë¡œëŠ” **ê²ŒìŠ¤íŠ¸ê°€ ì‘ì„±í•œ ë¬µìƒê¸€**ì…ë‹ˆë‹¤
   - ë‹µê¸€(replies)ê³¼ í˜¼ë™í•˜ì§€ ë§ˆì„¸ìš”

2. **ëª¨ë“  í”¼ë“œëŠ” unified_meditationsì—ì„œ ì¡°íšŒí•©ë‹ˆë‹¤** (2026-02-01 ë¦¬íŒ©í† ë§ ì™„ë£Œ)
   - í™ˆ í”¼ë“œ, êµíšŒ í”¼ë“œ, ê·¸ë£¹ í”¼ë“œ, í”„ë¡œí•„ í”¼ë“œ ëª¨ë‘ í†µí•©
   - ë ˆê±°ì‹œ í…Œì´ë¸”ì€ ì“°ê¸° ì „ìš© (íŠ¸ë¦¬ê±°ë¡œ ìë™ ë™ê¸°í™”)
   - ë™ê¸°í™”ê°€ ì•ˆ ë˜ë©´ í”¼ë“œì—ì„œ ê¸€ì´ ì•ˆ ë³´ì…ë‹ˆë‹¤

3. **visibility í•„ë“œ í•„ìˆ˜**
   - ëª¨ë“  ë¬µìƒê¸€ì— visibility ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤
   - NULLì´ë©´ RLSì—ì„œ í•„í„°ë§ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤

4. **íŠ¸ë¦¬ê±° ë™ì‘ í™•ì¸**
   - ìƒˆ ê¸€ ì‘ì„± í›„ unified_meditationsì— ìë™ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸
   - ë¬¸ì œ ì‹œ `scripts/backend-health-check.ts` ì‹¤í–‰

5. **Dual-Write íŒ¨í„´ í•„ìˆ˜ ì¤€ìˆ˜** (2026-02-01 ì¶”ê°€)
   - **INSERT/UPDATE/DELETEëŠ” ë°˜ë“œì‹œ ë ˆê±°ì‹œ í…Œì´ë¸”ì— ìˆ˜í–‰**
   - `unified_meditations`ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ë©´ ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œìƒ
   - Repositoryì˜ ìˆ˜ì •/ì‚­ì œ: `legacy_table`/`legacy_id` ì¡°íšŒ â†’ ë ˆê±°ì‹œ í…Œì´ë¸” ìˆ˜ì • â†’ íŠ¸ë¦¬ê±°ê°€ ë™ê¸°í™”
