#!/bin/sh

# λ°±μ—”λ“ κ΄€λ ¨ νμΌ λ³€κ²½ κ°μ§€
BACKEND_CHANGED=$(git diff --cached --name-only | grep -E "^supabase/|Repository\.ts$|\.sql$" || true)

if [ -n "$BACKEND_CHANGED" ]; then
  echo "π” λ°±μ—”λ“ κ΄€λ ¨ νμΌ λ³€κ²½ κ°μ§€λ¨. μ •ν•©μ„± κ²€μ‚¬ μ‹¤ν–‰..."
  echo "$BACKEND_CHANGED"
  echo ""

  # λ°±μ—”λ“ μ •ν•©μ„± κ²€μ‚¬ μ‹¤ν–‰
  npx tsx scripts/backend-health-check.ts

  # κ²€μ‚¬ κ²°κ³Ό ν™•μΈ (μ—λ¬κ°€ μμΌλ©΄ μ»¤λ°‹ μ¤‘λ‹¨)
  if [ $? -ne 0 ]; then
    echo ""
    echo "β λ°±μ—”λ“ μ •ν•©μ„± κ²€μ‚¬ μ‹¤ν¨. μ»¤λ°‹μ΄ μ¤‘λ‹¨λ©λ‹λ‹¤."
    exit 1
  fi

  echo ""
  echo "β… λ°±μ—”λ“ μ •ν•©μ„± κ²€μ‚¬ ν†µκ³Ό!"
fi
